# name: build and deploy

# on:
#   push:
#     branches:
#       - main

# jobs:
#   build:
#     runs-on: ubuntu-18.04
#     if: github.event.repository.owner.id == github.event.sender.id

#     steps:
#       - name: Checkout source ğŸ””
#         uses: actions/checkout@v2
#         with:
#           ref: main
#           # path: .deploy_git

#       - name: Setup Node.js ğŸ”§
#         uses: actions/setup-node@v1
#         with:
#           node-version: "12"

#       - name: Setup Hexo â³
#         env:
#           ACTION_DEPLOY_KEY: ${{ secrets.BLOG_PRIVATE_KEY }}
#         run: |
#           mkdir -p ~/.ssh/
#           echo "$ACTION_DEPLOY_KEY" > ~/.ssh/id_rsa
#           chmod 700 ~/.ssh
#           chmod 600 ~/.ssh/id_rsa
#           ssh-keyscan github.com >> ~/.ssh/known_hosts
#           git config --global user.email "qiongxing1412@qq.com"
#           git config --global user.name "QiongXing"
#           npm install hexo-cli -g
#           npm install

#       - name: Deploy ğŸš€
#         run: |
#           hexo clean
#           hexo deploy

name: Deploy GitHub Pages

# è§¦å‘æ¡ä»¶ï¼šåœ¨ push åˆ° master åˆ†æ”¯å
on:
  push:
    branches:
      - develop

# ä»»åŠ¡
jobs:
  build-and-deploy:
    # æœåŠ¡å™¨ç¯å¢ƒï¼šæœ€æ–°ç‰ˆ Ubuntu
    runs-on: ubuntu-latest
    steps:
      # æ‹‰å–ä»£ç 
      - name: Checkout
        uses: actions/checkout@v2
        with:
          persist-credentials: false

      # 1ã€ç”Ÿæˆé™æ€æ–‡ä»¶
      - name: Build
        run: npm install && npm run build

      # 2ã€éƒ¨ç½²åˆ° GitHub Pages
      - name: Deploy
        uses: JamesIves/github-pages-deploy-action@releases/v3
        with:
          ACCESS_TOKEN: ${{ secrets.BLOG_PRIVATE_KEY }}
          REPOSITORY_NAME: qiongxing/qiongxing.github.io
          BRANCH: dev-pages
          FOLDER: public
          #æ³¨æ„è¿™é‡Œçš„ public æ˜¯ä»“åº“æ ¹ç›®å½•ä¸‹çš„ publicï¼Œä¹Ÿå°±æ˜¯ npm run build ç”Ÿæˆé™æ€èµ„æºçš„è·¯å¾„ï¼Œæ¯”å¦‚æœ‰çš„äººæ˜¯ `docs/.vuepress/dist`

      # 3ã€åŒæ­¥åˆ° gitee çš„ä»“åº“
      # - name: Sync to Gitee
      #   uses: wearerequired/git-mirror-action@master
      #   env:
      #     # æ³¨æ„åœ¨ Settings->Secrets é…ç½® GITEE_RSA_PRIVATE_KEY
      #     SSH_PRIVATE_KEY: ${{ secrets.GITEE_RSA_PRIVATE_KEY }}
      #   with:
      #     # æ³¨æ„æ›¿æ¢ä¸ºä½ çš„ GitHub æºä»“åº“åœ°å€
      #     source-repo: git@github.com:somenzz/somenzz.github.io.git
      #     # æ³¨æ„æ›¿æ¢ä¸ºä½ çš„ Gitee ç›®æ ‡ä»“åº“åœ°å€
      #     destination-repo: git@gitee.com:somenzz/somenzz.git

      # # 4ã€éƒ¨ç½²åˆ° Gitee Pages
      # - name: Build Gitee Pages
      #   uses: yanglbme/gitee-pages-action@main
      #   with:
      #     # æ³¨æ„æ›¿æ¢ä¸ºä½ çš„ Gitee ç”¨æˆ·å
      #     gitee-username: somenzz
      #     # æ³¨æ„åœ¨ Settings->Secrets é…ç½® GITEE_PASSWORD
      #     gitee-password: ${{ secrets.GITEE_PASSWORD }}
      #     # æ³¨æ„æ›¿æ¢ä¸ºä½ çš„ Gitee ä»“åº“ï¼Œä»“åº“åä¸¥æ ¼åŒºåˆ†å¤§å°å†™ï¼Œè¯·å‡†ç¡®å¡«å†™ï¼Œå¦åˆ™ä¼šå‡ºé”™
      #     gitee-repo: somenzz/somenzz
      #     # è¦éƒ¨ç½²çš„åˆ†æ”¯ï¼Œé»˜è®¤æ˜¯ masterï¼Œè‹¥æ˜¯å…¶ä»–åˆ†æ”¯ï¼Œåˆ™éœ€è¦æŒ‡å®šï¼ˆæŒ‡å®šçš„åˆ†æ”¯å¿…é¡»å­˜åœ¨ï¼‰
      #     branch: master

      # 5ã€éƒ¨ç½²åˆ° somenzz.cn æœåŠ¡å™¨
      # - name: rsync deployments
      #   uses: burnett01/rsync-deployments@4.1
      #   with:
      #     # è¿™é‡Œæ˜¯ rsync çš„å‚æ•° switches: -avzh --delete --exclude="" --include="" --filter=""
      #     switches: -avzh
      #     path: public/
      #     remote_path: /home/ubuntu/public/
      #     remote_host: somenzz.cn
      #     remote_port: 22
      #     remote_user: ubuntu
      #     remote_key: ${{ secrets.MY_UBUNTU_RSA_PRIVATE_KEY }}
